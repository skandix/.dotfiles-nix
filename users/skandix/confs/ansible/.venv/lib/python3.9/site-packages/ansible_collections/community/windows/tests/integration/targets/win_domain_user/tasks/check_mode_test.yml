---

- name: Create Jane(check_mode)
  community.windows.win_domain_user:
    name: Jane
    password: J@n3P4ssw0rd#
    state: present
    update_password: on_create
    account_locked: false
    password_never_expires: false
    enabled: true
  register: new_user_check_mode
  failed_when:
    - not new_user_check_mode.changed
    - not new_user_check_mode.created
  check_mode: true

- name: Sanity check on Check Mode
  win_shell: |
    Get-AdUser -Identity Jane
  register: sanity_check
  failed_when: "'NotFound' not in sanity_check.stderr"
  changed_when: false
